<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AZWEC Show Calendar</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #C8102E 0%, #002868 50%, #FFB500 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 2rem;
            border-radius: 15px;
            margin-bottom: 2rem;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
        }

        .header h1 {
            color: #002868;
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            font-weight: 700;
        }

        .header p {
            color: #C8102E;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .shows-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }

        .show-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            transition: all 0.3s ease;
            border-left: 5px solid #FFB500;
            backdrop-filter: blur(10px);
        }

        .show-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 35px rgba(0, 0, 0, 0.2);
        }

        .show-card.licensed {
            border-left-color: #C8102E;
        }

        .show-card.schooling {
            border-left-color: #002868;
        }

        .show-date {
            font-size: 1.2rem;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
        }

        .show-date::before {
            content: "üìÖ";
            margin-right: 0.5rem;
        }

        .show-type {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 1rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .show-type.licensed {
            background: rgba(200, 16, 46, 0.1);
            color: #C8102E;
        }

        .show-type.schooling {
            background: rgba(0, 40, 104, 0.1);
            color: #002868;
        }

        .show-info {
            margin-bottom: 1rem;
        }

        .show-info h3 {
            color: #4a5568;
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
        }

        .show-info h3::before {
            content: "üìç";
            margin-right: 0.5rem;
        }

        .show-manager {
            color: #718096;
            font-size: 0.9rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
        }

        .show-manager::before {
            content: "üë§";
            margin-right: 0.5rem;
        }

        .show-link {
            display: inline-block;
            padding: 0.5rem 1rem;
            text-decoration: none;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
        }

        .show-link.active {
            background: #FFB500;
            color: #002868;
        }

        .show-link.active:hover {
            background: #e6a300;
            transform: translateY(-1px);
        }

        .show-link.inactive {
            background: #e2e8f0;
            color: #a0aec0;
            cursor: not-allowed;
        }

        .loading {
            text-align: center;
            padding: 3rem;
            color: white;
            font-size: 1.2rem;
        }

        .error {
            background: rgba(254, 178, 178, 0.9);
            color: #742a2a;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            text-align: center;
        }

        .stats {
            background: rgba(255, 255, 255, 0.9);
            padding: 1.5rem;
            border-radius: 10px;
            margin-bottom: 2rem;
            display: flex;
            justify-content: space-around;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .stat-item {
            flex: 1;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: #002868;
            display: block;
        }

        .stat-label {
            color: #718096;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        @media (max-width: 768px) {
            .shows-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .stats {
                flex-direction: column;
                gap: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>AZWEC Show Calendar</h1>
            <p>Arizona Working Equitation Scheduled Shows</p>
        </div>

        <div id="stats" class="stats" style="display: none;">
            <div class="stat-item">
                <span id="totalShows" class="stat-number">0</span>
                <span class="stat-label">Total Shows</span>
            </div>
            <div class="stat-item">
                <span id="licensedShows" class="stat-number">0</span>
                <span class="stat-label">Licensed Shows</span>
            </div>
            <div class="stat-item">
                <span id="schoolingShows" class="stat-number">0</span>
                <span class="stat-label">Schooling Shows</span>
            </div>
        </div>

        <div id="loading" class="loading" style="display: none;">
            Loading show data...
        </div>

        <div id="error" class="error" style="display: none;"></div>

        <div id="showsContainer" class="shows-grid"></div>
    </div>

    <script>
        let showData = [];

        // Function to parse date and sort shows chronologically
        function parseShowDate(dateStr) {
            if (!dateStr) return new Date('2099-12-31');
            
            // Handle various date formats
            let cleanDate = dateStr.replace(/\s+/g, ' ').trim();
            
            // Handle date ranges like "11/01-02 /25" or "05/16-17/26"
            if (cleanDate.includes('-') && !cleanDate.includes('26')) {
                // Extract the first date from range
                let parts = cleanDate.split('-');
                cleanDate = parts[0].trim();
            }
            
            // Handle formats like "05/30 & 31/26"
            if (cleanDate.includes('&')) {
                let parts = cleanDate.split('&');
                cleanDate = parts[0].trim();
            }
            
            // Add century if year is 2-digit
            if (cleanDate.match(/\/\d{2}$/)) {
                cleanDate = cleanDate.replace(/\/(\d{2})$/, (match, year) => {
                    return '/' + (parseInt(year) < 50 ? '20' + year : '19' + year);
                });
            }
            
            try {
                return new Date(cleanDate);
            } catch (e) {
                console.warn('Could not parse date:', dateStr);
                return new Date('2099-12-31');
            }
        }

        // Function to format date for display
        function formatDisplayDate(dateStr) {
            if (!dateStr) return '';
            
            // Keep the original format but clean it up
            return dateStr.replace(/\s+/g, ' ').trim();
        }

        // Function to process Excel data
        function processExcelData(data) {
            const shows = [];
            
            // Skip header rows (first 2 rows)
            for (let i = 2; i < data.length; i++) {
                const row = data[i];
                if (row && row[0] && row[0].toString().trim()) {
                    shows.push({
                        date: row[0],
                        type: row[1] || '',
                        location: row[2] || '',
                        manager: row[3] || '',
                        links: row[4] || ''
                    });
                }
            }
            
            // Sort shows by date
            shows.sort((a, b) => parseShowDate(a.date) - parseShowDate(b.date));
            
            return shows;
        }

        // Function to check if link is valid and active
        function isValidLink(link) {
            if (!link) return false;
            if (link === 'Entry Form Here' || link === 'Entry Forms here') return false;
            return link.startsWith('http');
        }

        // Function to create show card HTML
        function createShowCard(show) {
            const typeClass = show.type.toLowerCase().includes('licensed') ? 'licensed' : 'schooling';
            const displayDate = formatDisplayDate(show.date);
            
            const hasValidLink = isValidLink(show.links);
            const linkClass = hasValidLink ? 'active' : 'inactive';
            const linkText = hasValidLink ? 'More Info' : 'Info Coming Soon';
            
            let linkHtml = '';
            if (hasValidLink) {
                linkHtml = `<a href="${show.links}" target="_blank" class="show-link ${linkClass}">${linkText}</a>`;
            } else {
                linkHtml = `<button class="show-link ${linkClass}" disabled>${linkText}</button>`;
            }
            
            return `
                <div class="show-card ${typeClass}">
                    <div class="show-date">${displayDate}</div>
                    <div class="show-type ${typeClass}">${show.type}</div>
                    <div class="show-info">
                        <h3>${show.location}</h3>
                    </div>
                    <div class="show-manager">${show.manager}</div>
                    ${linkHtml}
                </div>
            `;
        }

        // Function to update statistics
        function updateStats(shows) {
            const totalShows = shows.length;
            const licensedShows = shows.filter(show => 
                show.type.toLowerCase().includes('licensed')
            ).length;
            const schoolingShows = totalShows - licensedShows;
            
            document.getElementById('totalShows').textContent = totalShows;
            document.getElementById('licensedShows').textContent = licensedShows;
            document.getElementById('schoolingShows').textContent = schoolingShows;
            document.getElementById('stats').style.display = 'flex';
        }

        // Function to render shows
        function renderShows(shows) {
            const container = document.getElementById('showsContainer');
            
            if (shows.length === 0) {
                container.innerHTML = '<div class="error">No show data found. Please upload a valid Excel file.</div>';
                return;
            }
            
            const showsHtml = shows.map(createShowCard).join('');
            container.innerHTML = showsHtml;
            
            updateStats(shows);
        }

        // Google Sheets configuration
        const GOOGLE_SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTmx2O8RzxSLBYBjBA4W8ekzoYi_jVlxZZtdEXICykeYKfAwMvfYG5xqXlZpBIUY4Da9fUTC1DVtXOS/pub?output=csv';

        // Function to load data from Google Sheets
        async function loadFromGoogleSheets() {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('error').style.display = 'none';
            
            try {
                // Try to fetch with no-cors mode to handle CORS issues
                const response = await fetch(GOOGLE_SHEET_URL, {
                    mode: 'cors',
                    headers: {
                        'Accept': 'text/csv'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const csvText = await response.text();
                console.log('CSV data received:', csvText.substring(0, 200) + '...'); // Log first 200 chars for debugging
                
                const rows = csvText.split('\n').map(row => {
                    // Simple CSV parsing - handles basic cases
                    const cells = [];
                    let current = '';
                    let inQuotes = false;
                    
                    for (let i = 0; i < row.length; i++) {
                        const char = row[i];
                        if (char === '"') {
                            inQuotes = !inQuotes;
                        } else if (char === ',' && !inQuotes) {
                            cells.push(current.trim());
                            current = '';
                        } else {
                            current += char;
                        }
                    }
                    cells.push(current.trim());
                    return cells;
                });
                
                console.log('Parsed rows:', rows.slice(0, 5)); // Log first 5 rows for debugging
                
                showData = processExcelData(rows);
                renderShows(showData);
                
            } catch (error) {
                console.error('Error details:', error);
                // Fall back to sample data if Google Sheets fails
                console.log('Falling back to sample data...');
                loadSampleData();
            } finally {
                document.getElementById('loading').style.display = 'none';
            }
        }

        // Fallback sample data function
        function loadSampleData() {
            const sampleData = [
                ["AZWEC Show Calendar"],
                ["Date", "Show Type", "Location", "Manager", "Links"],
                ["08/31/25", "Schooling", "4 Star Ranch, Chino Valley", "Judy MacKenzie / Susan Hapak", "https://www.facebook.com/p/4-Star-Ranch-Chino-Valley-AZ-100064331363647/"],
                ["09/20/25", "Licensed", "Payson Event Center, Payson AZ", "Vicki Clayton / Tessa Nicolet", "Entry Form Here"],
                ["09/21/25", "Licensed", "Payson Event Center, Payson AZ", "Vicki Clayton / Tessa Nicolet", "Entry Form Here"],
                ["10/18/25", "Schooling", "4 Star Ranch, Chino Valley AZ", "Judy MacKenzie/ Susan Hapak", "https://www.facebook.com/p/4-Star-Ranch-Chino-Valley-AZ-100064331363647/"],
                ["11/01-02 /25", "Licensed", "Hill Ranch, Cornville AZ", "Robin Lindsey"],
                ["12/06/25", "Licensed", "Sonoita Finals Show", "Amy Star/ Tessa Nicolet"]
            ];
            
            showData = processExcelData(sampleData);
            renderShows(showData);
            
            // Show a notice that we're using sample data
            document.getElementById('error').textContent = 'Note: Currently showing sample data. Google Sheets connection will work once hosted on GitHub Pages.';
            document.getElementById('error').style.display = 'block';
            document.getElementById('error').style.background = 'rgba(255, 243, 205, 0.9)';
            document.getElementById('error').style.color = '#744210';
        }

        // Load data when page loads
        document.addEventListener('DOMContentLoaded', function() {
            loadFromGoogleSheets();
        });
    </script>
</body>
</html>
